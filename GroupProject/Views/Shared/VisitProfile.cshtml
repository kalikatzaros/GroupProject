@model GroupProject.ViewModels.ProfileViewModel

<h2>Profile</h2>

<div>

    <hr />
    <div class="PersonalInfo">

        <h4>Personal Info</h4>
        <img src="~/img/@Url.Content(Model.ProfileImage)" width="150" height="150" style="border-radius: 75px" />
        <p>First Name : @Model.FirstName</p>
        <p>Last Name : @Model.LastName</p>
        <p>E-mail : @Model.Email</p>
        <p>Date of Birth : @Model.DateOfBirth.ToString("dd/MM/yyyy")</p>

    </div>
    <h2>

        @if (User.Identity.IsAuthenticated)
        {
            if (Model.LoggedUserFollowingIds.Contains(Model.User.Id))
            {
                <button class="btn btn-success js-toggle-follow"data-user-id="@Model.User.Id">Following</button>
            }
            else
            {
    <button class="btn btn-default js-toggle-follow"data-user-id="@Model.User.Id">Follow</button>
            }
        }
    </h2>
    <ul>
        @*@foreach (var follower in Model.User.Followers)
        {
            <li>

                <div class="details">
                    <span class="user">

                        @if (Model.ShowActions)
                        {
                            <button data-user-id="@Model.FullName"
                                    class="btn btn-link
                                @(Model.Followings.Contains(Model.FullName) ? "following" : "follow")
                                btn-sm js-toggle-follow">
                                @(Model.Followings.Contains(Model.FullName) ? "following" : "follow")
                            </button>
                        }
                    </span>
                </div>
            </li>
        }
    </ul>*@
    <table class="table">
        <tr>
            <th>
                @Html.DisplayName("My Posts")
            </th>
            <th></th>

        </tr>
        @if (Model.WallPosts.ToList().Count() < 1)
        {
            <tbody>
                <tr>
                    <td>
                        No Posts yet....
                    </td>
                </tr>

            </tbody>
        }

        @foreach (var item in Model.WallPosts)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Post.Body)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Post.Datetime)
                </td>

            </tr>
        }
    </table>
</div>

@section scripts {
    <script>
		$(document).ready(function () {

            $(".js-toggle-follow").click(function (e) {
                var button = e.target;
                var data2 = button.getAttribute("data-user-id");
                console.log(button.getAttribute("data-user-id"));

                if (button.classList.contains('btn-default')) {
                    $.post(
                        "/api/followings", { followeeId: data2 }
                    ).done(function () {
                        button.classList.remove("btn-default");
                        button.classList.add("btn-success");
                        button.innerText = "Following";
                     
                        location.reload();
                    }
                    )
                        .fail(function () {
                            alert("shit!");
                            console.log(button);
                        }
                        );
                } else {
                    $.ajax({
                        url: "/api/followings/" + data2,
                        method: "DELETE"
                    })
                        .done(function () {
                            button.classList.remove('btn-success');
                            button.classList.add('btn-default');
                            button.innerText = "Follow";
                            location.reload();
                          
                        })
                        .fail(function () {
                            alert("shit!");
                        });

                }

            });

		}
		);
    </script>
}

    <style>
        .btn:hover {
            color: white;
            background-color: blue;
        }
    </style>










